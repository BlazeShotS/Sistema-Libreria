{% extends "base.html" %}

{% block titulo %} Categorias {% endblock %}

{% block contenido %}

<h1 class="categorias-titulo">Categor√≠as</h1>

{% for categoria in categorias %}
<section class="categoria">
  <div class="categoria-header">
    <div class="categoria-nombre">
      <a href="{% url 'libreria:categorias_detalle' categoria.id %}">
        <!--Viene del for de categoria, sino que esta en modo url-->
        {{ categoria.nombre }}
      </a>
    </div>
  </div>


  <div class="libros-slider">
    <div class="libros-contenedor" id="slider-{{ categoria.id }}">
      {% for libro in categoria.libro_set.all %} <!--libro solo es un nombre de la variable temporal-->
      <div class="libro-card">
        {% if libro.imagen %}
        <img src="{{ libro.imagen.url }}" alt="{{ libro.titulo }}" class="libro-imagen">
        {% endif %}
        <h4 class="libro-titulo">{{ libro.titulo|truncatechars:30 }}</h4>
        <p class="libro-autor">{{ libro.autor }}</p>
        <p class="libro-precio">S/ {{ libro.precio }}</p>
      </div>
      {% endfor %}
    </div>
  </div>
  <a href="{% url 'libreria:categorias_detalle' categoria.id %}" class="ver-mas">Ver todos los libros <span
      class="flecha">‚Üí</span></a>
</section>
{% endfor %}

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const sliders = document.querySelectorAll(".libros-contenedor");

    sliders.forEach(slider => {
      const cards = slider.children;
      const total = cards.length;
      const visible = 3;   // libros visibles a la vez
      const step = 2;      // cantidad de libros que se mover√°n por paso
      const cardWidth = 220; // ancho aproximado + gap

      // üîÅ Clonamos los primeros libros para lograr el efecto infinito
      for (let i = 0; i < step; i++) {
        const clone = cards[i].cloneNode(true);
        slider.appendChild(clone);
      }

      let index = 0;

      function moveSlider() {
        index++;
        slider.style.transition = "transform 0.6s ease-in-out";
        slider.style.transform = `translateX(-${index * step * cardWidth}px)`;

        // Cuando llegamos al final (donde est√°n los clones), reiniciamos sin transici√≥n
        if (index >= total / step) {
          setTimeout(() => {
            slider.style.transition = "none";
            slider.style.transform = "translateX(0)";
            index = 0;
          }, 700); // justo despu√©s de que termine la animaci√≥n
        }
      }

      // ‚è±Ô∏è Se mueve cada 3 segundos
      setInterval(moveSlider, 3000);
    });
  });
</script>


{% endblock %}