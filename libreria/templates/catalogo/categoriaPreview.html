{% extends "base.html" %}

{% block titulo %} Categorias {% endblock %}

{% block contenido %}

<h1 class="categorias-titulo">Categorías</h1>

{% for categoria in categorias %}
  <section class="categoria">
    <div class="categoria-header">
      <h2 class="categoria-nombre">
        <a href="{% url 'libreria:categorias_detalle' categoria.id %}">
          {{ categoria.nombre }}
        </a>
      </h2>
      <a href="{% url 'libreria:categorias_detalle' categoria.id %}" class="ver-mas">
        Ver todos los libros →
      </a>
    </div>

    <p class="categoria-descripcion">{{ categoria.descripcion }}</p>

    <div class="libros-slider">
      <button class="btn-slider prev" data-target="#slider-{{ categoria.id }}">&#10094;</button>

      <div class="libros-contenedor" id="slider-{{ categoria.id }}">
        {% for libro in categoria.libro_set.all|slice:":10" %}
          <div class="libro-card">
            {% if libro.imagen %}
              <img src="{{ libro.imagen.url }}" alt="{{ libro.titulo }}" class="libro-imagen">
            {% endif %}
            <h4 class="libro-titulo">{{ libro.titulo|truncatechars:30 }}</h4>
            <p class="libro-precio">S/ {{ libro.precio }}</p>
          </div>
        {% endfor %}
      </div>

      <button class="btn-slider next" data-target="#slider-{{ categoria.id }}">&#10095;</button>
    </div>
  </section>


{% endfor %}


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const sliders = document.querySelectorAll(".libros-contenedor");

    sliders.forEach(slider => {
      let index = 0;
      const cards = slider.children;
      const total = cards.length;
      const visible = 5; // número visible aprox según ancho

      // Deslizamiento automático
      setInterval(() => {
        index = (index + 1) % (total - visible + 1);
        slider.style.transform = `translateX(-${index * 220}px)`;
      }, 4000);
    });

    // Botones manuales
    document.querySelectorAll(".btn-slider").forEach(btn => {
      btn.addEventListener("click", () => {
        const slider = document.querySelector(btn.dataset.target);
        const current = parseInt(slider.dataset.index || 0);
        const total = slider.children.length;
        const visible = 5;
        let newIndex = btn.classList.contains("next") ? current + 1 : current - 1;

        if (newIndex < 0) newIndex = total - visible;
        if (newIndex > total - visible) newIndex = 0;

        slider.dataset.index = newIndex;
        slider.style.transform = `translateX(-${newIndex * 220}px)`;
      });
    });
  });
</script>


{% endblock %}